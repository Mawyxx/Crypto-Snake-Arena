# üêç Crypto Snake Arena

> –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä–Ω–∞—è PvP-–∏–≥—Ä–∞ –≤ —Å—Ç–∏–ª–µ Slither.io –≤–Ω—É—Ç—Ä–∏ Telegram Mini App. –ò–≥—Ä–æ–∫–∏ –¥–µ–ª–∞—é—Ç —Å—Ç–∞–≤–∫—É –≤ USDT, –∑–∞—Ö–æ–¥—è—Ç –Ω–∞ –∞—Ä–µ–Ω—É, —Å–æ–±–∏—Ä–∞—é—Ç –º–æ–Ω–µ—Ç—ã –∏ —Å—Ä–∞–∂–∞—é—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –∑–º–µ–π–∫–∞–º–∏.

[![Go](https://img.shields.io/badge/Go-1.23+-00ADD8?logo=go)](https://go.dev/)
[![React](https://img.shields.io/badge/React-18-61DAFB?logo=react)](https://react.dev/)
[![PixiJS](https://img.shields.io/badge/PixiJS-7-EA5A6F)](https://pixijs.com/)
[![Telegram](https://img.shields.io/badge/Telegram-Mini%20App-26A5E4?logo=telegram)](https://core.telegram.org/bots/webapps)

---

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

**Crypto Snake Arena** ‚Äî high-performance –∏–≥—Ä–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏ –≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–µ. –ò–≥—Ä–æ–∫–∏:

- –í—ã–±–∏—Ä–∞—é—Ç —Å—Ç–∞–≤–∫—É (–æ—Ç 0.3 USDT)
- –ó–∞—Ö–æ–¥—è—Ç –Ω–∞ –∞—Ä–µ–Ω—É –∏ —Å–æ–±–∏—Ä–∞—é—Ç –º–æ–Ω–µ—Ç—ã
- –ü—Ä–∏ —Å–º–µ—Ä—Ç–∏ **80%** —Ç–µ–∫—É—â–µ–π —Å—É–º–º—ã (—Å—Ç–∞–≤–∫–∞ + –º–æ–Ω–µ—Ç—ã) –≤—ã–ø–∞–¥–∞–µ—Ç –≤ –≤–∏–¥–µ —Å—ä–µ–¥–æ–±–Ω—ã—Ö –º–æ–Ω–µ—Ç
- **20%** ‚Äî –∫–æ–º–∏—Å—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ —á–µ—Ä–µ–∑ Crypto Bot API.

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –°–ª–æ–π | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ |
|------|------------|
| **Backend** | Go 1.23, GORM, PostgreSQL, Redis |
| **Frontend** | React 18, Vite, PixiJS 7, Zustand, Tailwind CSS |
| **–°–≤—è–∑—å** | WebSocket + Protobuf (20 tick/s) |
| **–ü–ª–∞—Ç–µ–∂–∏** | Crypto Bot API |
| **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞** | Telegram Mini Apps (TMA SDK) |

---

## ‚ö° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Server-Authoritative)

| –ü—Ä–∏–Ω—Ü–∏–ø | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|---------|------------|
| **–ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** | –°–µ—Ä–≤–µ—Ä. –ö–ª–∏–µ–Ω—Ç ‚Äî —Ç–æ–ª—å–∫–æ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è. |
| **–§–∏–∑–∏–∫–∞** | –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç X,Y –∫–∞–∂–¥—ã–µ 50 ms (20 tick/s) |
| **–ö–æ–ª–ª–∏–∑–∏–∏** | –°–µ—Ä–≤–µ—Ä: –≥–æ–ª–æ–≤–∞ + —Ç–µ–ª–æ = —Å–º–µ—Ä—Ç—å; –≥–æ–ª–æ–≤–∞ + –º–æ–Ω–µ—Ç–∞ = –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ |
| **–ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è** | –ö–ª–∏–µ–Ω—Ç LERP –º–µ–∂–¥—É —Ç–∏–∫–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Crypto Snake Arena/
‚îú‚îÄ‚îÄ backend/                 # Go-—Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ cmd/server/          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/          # Entities, –ª–æ–≥–∏–∫–∞ (snake, coin, room)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usecase/         # GameManager, WalletManager
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game/            # Room, RoomManager
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/  # Repository, Payment, Auth, Redis
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ delivery/        # HTTP REST + WebSocket
‚îÇ   ‚îú‚îÄ‚îÄ migrations/          # SQL-–º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ proto/               # game.proto
‚îú‚îÄ‚îÄ frontend/                # React + PixiJS
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ shared/api/      # WebSocket, Protobuf
‚îÇ       ‚îú‚îÄ‚îÄ components/game/ # Arena, SnakeView, CoinView
‚îÇ       ‚îú‚îÄ‚îÄ pages/           # Home, Game, Profile, Leaderboard, Frens
‚îÇ       ‚îú‚îÄ‚îÄ store/           # Zustand
‚îÇ       ‚îî‚îÄ‚îÄ hooks/           # useBalance, useGameEngine...
‚îú‚îÄ‚îÄ deploy/                  # Nginx, setup-—Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ scripts/                 # start-single.ps1, run.ps1
‚îî‚îÄ‚îÄ docker-compose.yml       # –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (PostgreSQL, Redis, backend)
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.23+
- Node.js 18+
- PostgreSQL 16+
- Redis 7+
- [ngrok](https://ngrok.com/) (–¥–ª—è Telegram Mini App)

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# PostgreSQL: —Å–æ–∑–¥–∞–π –ë–î
createdb crypto_snake

# Redis ‚Äî –∑–∞–ø—É—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ
redis-server
```

### 2. Backend

```bash
cd backend
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏ TELEGRAM_BOT_TOKEN
go run ./cmd/server
```

### 3. Frontend –∏ ngrok (Windows PowerShell)

```powershell
# –û–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç: –±—ç–∫ + —Å—Ç–∞—Ç–∏–∫–∞ + ngrok
.\scripts\start-single.ps1
```

–°–∫—Ä–∏–ø—Ç —Å–æ–±–µ—Ä—ë—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –∑–∞–ø—É—Å—Ç–∏—Ç –±—ç–∫–µ–Ω–¥ –Ω–∞ –ø–æ—Ä—Ç—É 8081 –∏ ngrok. –î–∞–ª—å—à–µ:

1. –°–∫–æ–ø–∏—Ä—É–π HTTPS URL –∏–∑ –æ–∫–Ω–∞ ngrok
2. `frontend/.env.local`: `VITE_WS_URL=wss://YOUR_NGROK_URL/ws`
3. BotFather ‚Üí Edit App ‚Üí Web App URL = `https://YOUR_NGROK_URL`
4. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏: `cd frontend && npm run build`

### 4. –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd backend
make reset-db   # –∏–ª–∏: powershell -ExecutionPolicy Bypass -File scripts/reset_db.ps1
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º ‚Äî [backend/README.md](backend/README.md).

---

## üê≥ Docker (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫)

```bash
# –°–æ–∑–¥–∞–π .env —Å TELEGRAM_BOT_TOKEN
export TELEGRAM_BOT_TOKEN=your_token
docker compose up -d
```

–°–µ—Ä–≤–∏—Å—ã:
- **Backend** ‚Üí `http://localhost:8080`
- **PostgreSQL** ‚Üí `5432`
- **Redis** ‚Üí `6379`

---

## üåê –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

1. –ù–∞—Å—Ç—Ä–æ–π —Å–µ—Ä–≤–µ—Ä: `sudo bash deploy/setup-server.sh`
2. –î–æ–±–∞–≤—å GitHub Secrets: `DEPLOY_HOST`, `DEPLOY_USER`, `DEPLOY_SSH_KEY`
3. Push –≤ `main` ‚Äî GitHub Actions –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–î–µ—Ç–∞–ª–∏: [deploy/DEPLOY.md](deploy/DEPLOY.md)

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Backend (`backend/.env`)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `DATABASE_URL` | PostgreSQL connection string |
| `REDIS_URL` | Redis URL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `localhost:6379`) |
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather |
| `WEBHOOK_SECRET_TOKEN` | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ ‚Äî –¥–ª—è webhook —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ |
| `PORT` | –ü–æ—Ä—Ç HTTP (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8080) |
| `ALLOWED_ORIGINS` | CORS (`*` –¥–ª—è dev) |

### Frontend (`frontend/.env.local`)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `VITE_WS_URL` | WebSocket URL (–Ω–∞–ø—Ä–∏–º–µ—Ä `wss://arrenasnake.net/ws`) |
| `VITE_TELEGRAM_BOT_USERNAME` | Username –±–æ—Ç–∞ –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **initData**: Telegram –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç `initData`. Backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç HMAC-SHA256 –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç `user_id`.
- **–ù–∏–∫–æ–≥–¥–∞** –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user_id` –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî —Ç–æ–ª—å–∫–æ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Authorization: tma <initData>`.
- Replay: `expires_in: 1 hour` –¥–ª—è –¥–µ–Ω–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| [PROJECT_SUMMARY.md](PROJECT_SUMMARY.md) | –ò—Ç–æ–≥–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç—É, –∞—É–¥–∏—Ç |
| [context.md](context.md) | –î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, Proto, Redis, —ç–∫–æ–Ω–æ–º–∏–∫–∞ |
| [backend/README.md](backend/README.md) | –ó–∞–ø—É—Å–∫ –±—ç–∫–∞, –º–∏–≥—Ä–∞—Ü–∏–∏ |
| [deploy/DEPLOY.md](deploy/DEPLOY.md) | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é |

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω—ã–π –ø—Ä–æ–µ–∫—Ç.
